<html>

<head>
  <title>Pursuit Curves</title>
  <meta content="Pursuit Curves, canvas, js, creative coding, generative art, genart" name="keywords">
  <meta content="Draw a pursuit curve on the canvas" name="description">
  <meta property="og:image" content="http://jlchapa.azurewebsites.net/img/pursuitcurves.png" />
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,400' rel='stylesheet' type='text/css'>
  <style>
    body{
      font-family: 'Source Sans Pro', 'Open Sans', 'Verdana', 'Monospaced';
      margin: 0 auto;
      overflow: hidden;
      color: #fff;
    }

    div.main{
      position: absolute;
      bottom: 0px;
      left: 0px;
      width: 500px;
      padding: 5px;
    }
    h1{
      font-weight: bold;
      font-size: 14pt;
      margin: 5px 0;
    }
    a{
      text-decoration: none;
      background-color: #0078e7;
      font-size: 11pt;
      padding: 5px 10px;
      border-radius: 3px;
      border:none;
      margin-bottom: 10px;
      display: inline-block;
      color: #fff;
    }

    a:hover{
      background-color: #1f8dd6;
    } 

    a:visited{
      color: #fff;
    }

    input.number{
      width: 50px;
    }

    div.q{
      float: left;
    }

    #q1, #q3{
      width: 200px;
    }

    #q2, #q4{
      width: 285px;
    }

    #q2{
      text-align: right;    
    }

  </style>

  <script src="../js/randomColor.js"></script>
  <script src="../js/fileSaver.js"></script>
  <script src="../js/jquery-2.1.3.min.js"></script>
  <script src="../js/ga.js"></script>
  
</head>

<body>

  <canvas id="canvas"></canvas>
  <div class="main">
    <h1>PURSUIT CURVES</h1>
    <br/>
    <div class="q" id="q1">
      <input type='number' class="number" value="4" step='1' min='3' max='15' onchange="updateN(this.value)"/>  
      POLYGON SIDES
    </div>

    <div class="q" id="q2"><a href="#" onclick="save()" id="download">Save as image</a> </div>

    <div class="q" id="q3">
      <input type="radio" name="color" value="white" class="colorCheck" checked> BLACK AND WHITE <br/>
      <input type="radio" name="color" value="random" class="colorCheck"> RANDOM COLORS <br/>
      <input type="radio" name="color" value="two" class="colorCheck"> STRIPES <br/>
    </div>

    <div class="q" id="q4">
      <input id="rad" type='range' value="900" step='20' min='100' max='1000' onchange="updateR(this.value)"/> 
      INITIAL RADIUS
      <br/>
      <input type='range' value="80" step='10' min='1' max='500' onchange="updateI(this.value)"/> 
      ITERATIONS
      <br/>
      <input type='range' value="10" step='1' min='2' max='50' onchange="updateDt(this.value)"/> 
      TIME DELTA 
    </div>

  </div>

  <script>
  /* Curvas de persecución
    Se presenta la solución al "problema de las tortugas/ratones/etc" de  manera numérica.
    Los parámetros modificables son el número de lados n del polígono, la
    velocidad Vel de los móviles, la distancia radial inicial radius
    */
    var canvas  = document.getElementById('canvas');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    var ctx = canvas.getContext('2d');
    ctx.lineWidth = 1;
    ctx.fillStyle = "#000";
    ctx.strokeStyle = "#FFF";

    var centerX = Math.floor(canvas.width/2);
    var centerY = Math.floor(canvas.height/2);
    var pi180 = Math.PI/180;
    var link = document.getElementById('download');
    console.log("Protip: See it in fullscreen and use the image as wallpaper.");
    
    var n = 4;        // Lados del polígono
    var Vel = -1;     // Velocidad en [m/s]
    var radius = centerX-10;      // Radio inicial
    $("#rad").val(radius);
    var dt = 1/10;
    var N = 80;
    var useRandomColors = false;
    var useTwoColors = false;
    var colors = ["#FF0000", "#0000FF"];

    //iniciales
    var posiciones = [];
    for(i=0; i<N; i++){
      posiciones.push([]);
    }

    function save(){
      if(canvas.toBlob == undefined){
        link.href = canvas.toDataURL();
        link.download = "pursuitcurve.png";
      }else{
        canvas.toBlob(function(blob) {
          saveAs(blob, "pursuitcurve.png");
        });
      }
    }

    function drawPursuitCurves(){
      var i, j;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.translate(centerX, centerY);

      var firstX, firstY;

      for(j=0; j<N; j++){
        var pos = posiciones[j];

        ctx.beginPath();

        for(i=0; i<n; i++){
          var x = pos[i][0];
          var y = pos[i][1];       
          ctx.lineTo(x, y);
          if(i==0){
            firstY=y;
            firstX=x;  
          }
        }

        ctx.lineTo(firstX, firstY);

        if(useRandomColors){
          ctx.strokeStyle = randomColor();
        }
        ctx.stroke();
        ctx.closePath();
        
      }

    }

    function drawPursuitCurves2(){
      var i, j;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.translate(centerX, centerY);

      var firstX, firstY;
      var lastX, lastY;
      var cl = colors.length;

      for(j=0; j<N; j++){
        var pos = posiciones[j];
        
        for(i=0; i<n-1; i++){
          var x = pos[i][0];
          var y = pos[i][1];
          var x2 = pos[i+1][0];
          var y2 = pos[i+1][1];
          
          if(i==0){
            firstY=y;
            firstX=x;  
          }
          if(i==n-2){
            lastX  = x2;
            lastY  = y2;
          }

          ctx.beginPath();
          ctx.moveTo(x, y);
          ctx.lineTo(x2, y2);
          ctx.strokeStyle = colors[i%cl];
          ctx.stroke();
          ctx.closePath();
        }


        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(firstX, firstY);
        ctx.strokeStyle = colors[cl-1];
        ctx.stroke();
        ctx.closePath();
        
      }

    }

    function calculatePositions(){

      var i,j;
      posiciones[0] = [];
      for(i=0; i<n; i++){
        var angle = (360/n) * i;
        var x = radius * Math.cos(angle  * pi180);
        var y = radius * Math.sin(angle  * pi180);
        posiciones[0].push([x,y, angle]);
      }

      for(j=1; j<N; j++){
        posiciones[j] = [];
        for(i=0; i<n; i++){
          var posAnt = posiciones[j-1];
          var xA = posAnt[i][0];
          var yA = posAnt[i][1];
          var xB = 0;
          var yB = 0;

          if(i==n-1){
            xB = posAnt[0][0];
            yB = posAnt[0][1];
          }else{
            xB = posAnt[i+1][0];
            yB = posAnt[i+1][1];
          }

          var x = xA + ((xA-xB) * (dt*Vel) );
          var y = yA + ((yA-yB) * (dt*Vel) );

          posiciones[j].push([x,y,0]);
        }
      }

    }

    function calculateAndDraw(){
      ctx.setTransform(1, 0, 0, 1, 0, 0);
      calculatePositions();
      if(useTwoColors){
        drawPursuitCurves2();
      }else{
        drawPursuitCurves();      
      }
      
    }

    function updateN(newn){
      n = newn;
      colors = [];
      var i=0;
      for(i=0; i<n; i++){
        colors.push(randomColor());
      }
      calculateAndDraw();
    }

    function updateR(newr){
      radius = newr;
      calculateAndDraw();
    }

    function updateDt(newdt){
      dt = 1/newdt;
      calculateAndDraw(); 
    }

    function updateI(newi){
      N = newi;
      calculateAndDraw(); 
    }

    $(".colorCheck").change(function() {
      if(this.value == "white"){
        useRandomColors = false;
        useTwoColors = false;
        ctx.strokeStyle = "#FFF";
      }else if(this.value == "random"){
        useRandomColors = true;
        useTwoColors = false;
      }else if(this.value == "two"){
        useTwoColors = true;
        useRandomColors = false;
      }
      calculateAndDraw();
    });

    calculateAndDraw();


  </script>
</body>
</html>