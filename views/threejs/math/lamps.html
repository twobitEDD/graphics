<!DOCTYPE html>
<html lang="en">
<head>
    <title>Lamps</title>
    <meta content="Threejs, WebGl, js, creative coding, generative art, genart" name="keywords">
    <meta content="Lamps " name="description">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <style>
        body {
            font-family: "Open Sans", "Arial", Monospace;
            background-color: #000;
            color: #fff;
            margin: 0px;
            overflow: hidden;
        }
    </style>
    <script src="../js/build/three.min.js"></script>
    <script src="../js/build/TrackballControls.js"></script>
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/randomColor.js"></script>

    <script id="cubeFragmentShader" type="x-shader/x-fragment">
        uniform float time;
        varying vec2 vUv;

        void main() {
            vec2 position = -1.0 + 2.0 * vUv;

            float red = abs(sin(position.x * position.y + time / 5.0));
            float green = abs(sin(position.x * position.y + time / 4.0));
            float blue = abs(sin(position.x * position.y + time / 3.0 ));
            gl_FragColor = vec4(red, green, blue, 1.0);
        }
    </script>

    <script id="cubeVertexShader" type="x-shader/x-vertex">
        uniform float time;
        varying vec2 vUv;

        void main() {
            vUv = uv;
            vec3 newPosition = position + normal * vec3(sin(time * 0.2) * 3.0);
            gl_Position = projectionMatrix <i> modelViewMatrix </i> vec4(newPosition, 1.0);
        }
    </script>
</head>

<body>
    <div id="container"></div>
    <script>

        var container, camera, scene, renderer, controls;
        var TWO_PI = 2 * Math.PI;
        var windowHalfX = window.innerWidth / 2;
        var windowHalfY = window.innerHeight / 2;
        var bulbMaterial;
        var bulbs = [];
        var bulbCount = 20;
        var distanceBetweenBulbs = 100;
        var uniforms;
        var clock;

        function init() {

            /* SCENE*/
            container = document.getElementById('container');
            scene = new THREE.Scene();

            clock = new THREE.Clock();

            /* CAMERA*/
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 2000);
            camera.position.y = -100;
            camera.position.z = 1000;
            // camera.up = new THREE.Vector3(0, 0, 1);
            // camera.lookAt(new THREE.Vector3(0, 0, 0));

            /*LIGHTS*/
            var d = 500;
            var ambient = new THREE.AmbientLight(0x666666);
            var l1 = createDirectionalLight(d, 0.8, 200, 300, 0);
            var l2 = createDirectionalLight(d, 0.8, -200, 200, 500);
            scene.add(ambient);
            scene.add(l1);
            scene.add(l2);

            /* TEXTURES*/
            var textureSquares = THREE.ImageUtils.loadTexture("img/bright_squares256.png");
            textureSquares.repeat.set(50, 50);
            textureSquares.wrapS = textureSquares.wrapT = THREE.RepeatWrapping;
            textureSquares.magFilter = THREE.NearestFilter;
            textureSquares.format = THREE.RGBFormat;

            /* MATERIALS*/
            var planeMaterial = new THREE.MeshLambertMaterial({ color: 0x333333 });
            var groundMaterial = new THREE.MeshPhongMaterial({
                shininess: 80,
                color: 0xff0000,
                specular: 0xffffff,
                map: textureSquares
            });
            bulbMaterial = new THREE.MeshPhongMaterial({
                color: 0x000000,
                specular: 0xffffff,
                shininess: 80
            });

            /* GROUND*/
            plane = new THREE.Mesh(new THREE.PlaneGeometry(800, 500), planeMaterial);
            plane.material.side = THREE.DoubleSide;
            plane.receiveShadow = true;
            plane.castShadow = false;
            scene.add(plane)

            uniforms = {
                time: { type: "f", value: 0 },
                resolution: { type: "v2", value: new THREE.Vector2 }
            };

            for(i=0; i<bulbCount; i++){
                var bulb = createBulbs();
                bulb.position.z = i*distanceBetweenBulbs;
                bulb.rotation.z = i*0.05;
                bulbs.push(bulb);
                scene.add( bulb );
            }


            

            renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMapEnabled = true;
            renderer.shadowMapSoft = true;
            container.appendChild(renderer.domElement);
            createControls();

            window.addEventListener('resize', onWindowResize, false);
        }


        /*ANIMATIONS*/

        function createDirectionalLight(d, intensity, x, y, z) {
            var light = new THREE.DirectionalLight(0xdfebff, intensity);

            light.position.set(x, y, z);
            light.castShadow = true;
            light.shadowMapWidth = light.shadowMapHeight = 512;
            light.shadowCameraLeft = -d;
            light.shadowCameraRight = d;
            light.shadowCameraTop = d;
            light.shadowCameraBottom = -d;
            light.shadowCameraFar = 10000;
            light.shadowDarkness = 0.3;

            return light;
        }


        function createBulbs(){
            var group = new THREE.Object3D();
            var r = 10;
            
            var geometryC1 = new THREE.CylinderGeometry( r, r, 200, 32 );
            var geometryC2 = new THREE.CylinderGeometry( r, r, 100, 32 );

            //var material = new THREE.MeshBasicMaterial( {color: 0x555555} );
            
            var itemMaterial = new THREE.ShaderMaterial({
                uniforms: uniforms,
                vertexShader: document.getElementById('cubeVertexShader').innerHTML,
                fragmentShader: document.getElementById('cubeFragmentShader').innerHTML
            });

            var cylinder1 = new THREE.Mesh( geometryC1, bulbMaterial );
            cylinder1.position.x = -80;
            var cylinder2 = new THREE.Mesh( geometryC1, bulbMaterial );
            cylinder2.position.x = 80;

            var cylinder3 = new THREE.Mesh( geometryC2, bulbMaterial );
            cylinder3.rotation.z = 90*(Math.PI / 180);
            cylinder3.position.y = -90;
            cylinder3.position.x = -15;
            var cylinder4 = new THREE.Mesh( geometryC2, bulbMaterial );
            cylinder4.rotation.z = 90*(Math.PI / 180);
            cylinder4.position.y = 90;
            cylinder4.position.x = 15;
            
            group.add( cylinder1 );
            group.add( cylinder2 );
            group.add( cylinder3 );
            group.add( cylinder4 );
            return group;
        }

        function onWindowResize() {
            windowHalfX = window.innerWidth / 2;
            windowHalfY = window.innerHeight / 2;
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            var delta = clock.getDelta();
            uniforms.time.value += delta * 10;
            var i=0;
            for(i=0; i<bulbs.length; i++){
                var bulb = bulbs[i];
                bulb.position.z++;
                if(bulb.position.z >= distanceBetweenBulbs*bulbCount){
                    bulb.position.z = 0;
                }

                bulb.rotation.z+= 0.0005;
            }
            


            controls.update();
            render();
        }

        function render() {
            renderer.render(scene, camera);
        }

        function createControls(){
            controls = new THREE.TrackballControls(camera, renderer.domElement);
            controls.target.set(0, 120, 0);
            controls.rotateSpeed = 1.0;
            controls.zoomSpeed = 1.2;
            controls.panSpeed = 0.8;
            controls.noZoom = false;
            controls.noPan = false;
            controls.staticMoving = true;
            controls.dynamicDampingFactor = 0.15;
            controls.keys = [65, 83, 68];
        }

        init();
        animate();

    </script>
</body>
</html>
