<html>

<head>
	<title>Painters II</title>
	<meta content="Delaunay, gradient, canvas, js, creative coding, generative art, genart" name="keywords">
	<meta content="Using delaunay triangulation over a set of moving particles" name="description">

	<style>
		body{
			font-family: 'Open Sans', 'Verdana', 'Monospaced';
			margin: 0 auto;
			overflow: hidden;
			color: #fff;
		}
		div{
			position: absolute;
			bottom: 0;
			left: 0;
			height: 30px;
		}
		a{
			text-decoration: none;
			background-color: #95CBAB;
			font-size: 12px;
			padding: 2px 3px;
			border-radius: 2px;
			border:none;
			display: inline-block;
			color: #fff;
		}
		a:hover{
			background-color: #1f8dd6;
		} 
		a:visited{
			color: #444;
		}
	</style>

	<script type="text/javascript" src="../js/delaunay.js"> </script>
	<script src="../js/ga.js"></script>
	
	<head>
		<body>
			<canvas id="canvas"></canvas>
			<div>
				<a href="#" onclick="setPoints(5);">5</a>
				<a href="#" onclick="setPoints(10);">10</a>
				<a href="#" onclick="setPoints(25);">25</a>
				<a href="#" onclick="setPoints(50);">50</a>
				<span>Click to restart</span>
			</div>

			<script type="text/javascript">
				
				var canvas = document.getElementById("canvas");
				var ctx = canvas.getContext("2d");
				var Width, Height;
				var particleCount = 25,
				particles = null,
				blobRadius = 0;

				var gradients = [["#70E3BC", "#89DA95"],
				["#BEE7AD", "#92E7C6"],
				["#9DD08E", "#A7D992"],
				["#2B968E", "#47B495"],
				["#217985", "#208188"],
				["#21556B", "#206173"],
				["#22566C", "#225F71"],
				["#2BA195", "#4FBF99"]];

				function setPoints(count){
					particleCount = count;
					init();
				}

				function paintCanvas() {
					
					var grd=ctx.createLinearGradient(0, 0, Width, Height);
					grd.addColorStop(0, "#ECFFBF");
					grd.addColorStop(0.3, "#1A818F");
					grd.addColorStop(0.7, "#032A2F");
					grd.addColorStop(1, "#000A2F");
					ctx.fillStyle=grd;
					ctx.fillRect(0,0,Width,Height);
				}

				function Particle(id) {

					this.x = 0;
					this.y = 0;

					this.resetPosition = function(){
						var angle = Math.random()*Math.PI*2;
						var radius = Math.random() * blobRadius;
						this.x = Width/2 + Math.cos(angle)*radius;
						this.y = Height/2 + Math.sin(angle)*radius;
					}

					this.resetVelocity = function(){
						this.vx = 0.3 * (-1 + Math.random() * 2);
						this.vy = 0.3 * (-1 + Math.random() * 2);
					}

					this.resetVelocity();
					this.resetPosition();

				}

				function setSizes(){
					Width = window.innerWidth;
					Height = window.innerHeight;
					canvas.width = Width;
					canvas.height = Height;
					blobRadius = Height/3;
				}

				function init(){

					particles = [];
					for(var i = 0; i < particleCount; i++) {
						particles.push(new Particle(i));
					}
				}

				function onWindowClick(){
					paintCanvas();
					for(var i = 0; i < particleCount; i++) {
						particles[i].resetPosition();
						particles[i].resetVelocity();
					}
				}

				function onWindowResize(){
					setSizes();
					init();
				}

				function draw(){

					var usedColor = 1;

					var vertices = new Array(particleCount);
					for(var i = 0; i < particleCount; i++) {
						vertices[i] = [particles[i].x, particles[i].y];
					}

					var triangles = Delaunay.triangulate(vertices);
					var grX, grX2, grY, grY2;
					for(i = triangles.length; i; ) {
						
						ctx.beginPath();
						--i;
						ctx.moveTo(vertices[triangles[i]][0], vertices[triangles[i]][1]);
						grX = vertices[triangles[i]][0];
						grY = vertices[triangles[i]][1];
						--i;
						ctx.lineTo(vertices[triangles[i]][0], vertices[triangles[i]][1]);
						grX2 = vertices[triangles[i]][0];
						grY2 = vertices[triangles[i]][1];
						--i;
						ctx.lineTo(vertices[triangles[i]][0], vertices[triangles[i]][1]);
						ctx.closePath();
						
						var grd=ctx.createLinearGradient(grX, grX2, grY, grY2);
						grd.addColorStop(0,gradients[usedColor%8][0]);
						grd.addColorStop(1,gradients[usedColor%8][1]);
						usedColor++;
						ctx.fillStyle=grd;
						ctx.fill();
					}

				}

				function update() {

					for (var i = 0; i < particles.length; i++) {
						p = particles[i];

						p.x += p.vx;
						p.y += p.vy

						if(p.x > Width/2 + blobRadius  ||
							p.y > Height/2 + blobRadius ||
							p.x + blobRadius < Width/2  || 
							p.y + blobRadius < Height/2    ) 
						{
							p.x = Width/2;
							p.y = Height/2;
						}
					}
				}

				// Start the main animation loop using requestAnimFrame
				function animate() {
					paintCanvas();
					update();
					draw();
					requestAnimFrame(animate);
				}

				window.requestAnimFrame = (function(){
					return  window.requestAnimationFrame       || 
					window.webkitRequestAnimationFrame || 
					window.mozRequestAnimationFrame    || 
					window.oRequestAnimationFrame      || 
					window.msRequestAnimationFrame     ||  
					function( callback ){
						window.setTimeout(callback, 1000 / 60);
					};
				})();

				window.addEventListener( 'click', onWindowClick, false );
				window.addEventListener( 'resize', onWindowResize, false );


				setSizes();
				init();
				animate();

			</script>

		</body>
		</html>